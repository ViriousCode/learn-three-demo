const t = [
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ303",
        "name": "SO2",
        "unit": "ug/m3",
        "ts": 1764851104000,
        "value": 51.48,
        "lat": 29.911015,
        "lng": 121.83595,
        "temp": 20.11,
        "hum": 30.89,
        "hf_monitor_id": "b363b9ae-0323-46c5-9a2f-39af42d52baa",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:04"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ306",
        "name": "O3",
        "unit": "ug/m3",
        "ts": 1764851104000,
        "value": 94.28,
        "lat": 29.911015,
        "lng": 121.83595,
        "temp": 20.11,
        "hum": 30.89,
        "hf_monitor_id": "b363b9ae-0323-46c5-9a2f-39af42d52baa",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:04"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ302",
        "name": "PM10",
        "unit": "ug/m3",
        "ts": 1764851104000,
        "value": 94,
        "lat": 29.911015,
        "lng": 121.83595,
        "temp": 20.11,
        "hum": 30.89,
        "hf_monitor_id": "b363b9ae-0323-46c5-9a2f-39af42d52baa",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:04"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ307",
        "name": "VOCs",
        "unit": "ppb",
        "ts": 1764851104000,
        "value": 26,
        "lat": 29.911015,
        "lng": 121.83595,
        "temp": 20.11,
        "hum": 30.89,
        "hf_monitor_id": "b363b9ae-0323-46c5-9a2f-39af42d52baa",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:04"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ301",
        "name": "PM2.5",
        "unit": "ug/m3",
        "ts": 1764851104000,
        "value": 76,
        "lat": 29.911015,
        "lng": 121.83595,
        "temp": 20.11,
        "hum": 30.89,
        "hf_monitor_id": "b363b9ae-0323-46c5-9a2f-39af42d52baa",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:04"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ304",
        "name": "CO",
        "unit": "mg/m3",
        "ts": 1764851104000,
        "value": 0.06,
        "lat": 29.911015,
        "lng": 121.83595,
        "temp": 20.11,
        "hum": 30.89,
        "hf_monitor_id": "b363b9ae-0323-46c5-9a2f-39af42d52baa",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:04"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ305",
        "name": "NO2",
        "unit": "ug/m3",
        "ts": 1764851104000,
        "value": 118.15,
        "lat": 29.911015,
        "lng": 121.83595,
        "temp": 20.11,
        "hum": 30.89,
        "hf_monitor_id": "b363b9ae-0323-46c5-9a2f-39af42d52baa",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:04"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ304",
        "name": "CO",
        "unit": "mg/m3",
        "ts": 1764851115000,
        "value": 0.06,
        "lat": 29.911007,
        "lng": 121.835945,
        "temp": 20.59,
        "hum": 30.46,
        "hf_monitor_id": "53b52736-6782-42dd-abf2-2926e3dbe6d2",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:15"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ303",
        "name": "SO2",
        "unit": "ug/m3",
        "ts": 1764851115000,
        "value": 51.48,
        "lat": 29.911007,
        "lng": 121.835945,
        "temp": 20.59,
        "hum": 30.46,
        "hf_monitor_id": "53b52736-6782-42dd-abf2-2926e3dbe6d2",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:15"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ305",
        "name": "NO2",
        "unit": "ug/m3",
        "ts": 1764851115000,
        "value": 32.49,
        "lat": 29.911007,
        "lng": 121.835945,
        "temp": 20.59,
        "hum": 30.46,
        "hf_monitor_id": "53b52736-6782-42dd-abf2-2926e3dbe6d2",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:15"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ301",
        "name": "PM2.5",
        "unit": "ug/m3",
        "ts": 1764851115000,
        "value": 64,
        "lat": 29.911007,
        "lng": 121.835945,
        "temp": 20.59,
        "hum": 30.46,
        "hf_monitor_id": "53b52736-6782-42dd-abf2-2926e3dbe6d2",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:15"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ307",
        "name": "VOCs",
        "unit": "ppb",
        "ts": 1764851115000,
        "value": 93,
        "lat": 29.911007,
        "lng": 121.835945,
        "temp": 20.59,
        "hum": 30.46,
        "hf_monitor_id": "53b52736-6782-42dd-abf2-2926e3dbe6d2",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:15"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ302",
        "name": "PM10",
        "unit": "ug/m3",
        "ts": 1764851115000,
        "value": 83,
        "lat": 29.911007,
        "lng": 121.835945,
        "temp": 20.59,
        "hum": 30.46,
        "hf_monitor_id": "53b52736-6782-42dd-abf2-2926e3dbe6d2",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:15"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ306",
        "name": "O3",
        "unit": "ug/m3",
        "ts": 1764851115000,
        "value": 94.28,
        "lat": 29.911007,
        "lng": 121.835945,
        "temp": 20.59,
        "hum": 30.46,
        "hf_monitor_id": "53b52736-6782-42dd-abf2-2926e3dbe6d2",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:15"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ307",
        "name": "VOCs",
        "unit": "ppb",
        "ts": 1764851126000,
        "value": 84,
        "lat": 29.911009,
        "lng": 121.835945,
        "temp": 21.02,
        "hum": 29.94,
        "hf_monitor_id": "f3e7c52d-53ab-4d10-aa92-c539c8517acb",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:26"
    },
    {
        "rn": "137178",
        "sn": "1140260018",
        "code": "KQ302",
        "name": "PM10",
        "unit": "ug/m3",
        "ts": 1764851126000,
        "value": 81,
        "lat": 29.911009,
        "lng": 121.835945,
        "temp": 21.02,
        "hum": 29.94,
        "hf_monitor_id": "f3e7c52d-53ab-4d10-aa92-c539c8517acb",
        "hf_monitor_exp_id": null,
        "patrol_id": "29954b5b-ab7d-41a8-a4d2-d6ca6a95302d",
        "ts_date_time": "2025-12-04 20:25:26"
    }
]
const val = [
    // 按因子、时间转成
    [
        1739325789000,//时间
        121.799164,//经度
        29.894512,//纬度
        0,//因子1
        7.517,//因子2
        0,
        0.25,
        0,
        8.53
    ]
]
// 将t数据转换为val格式
function convertTToVal(t) {
  // 按时间分组数据
  const groupedByTime = {};
  
  t.forEach(item => {
    if (!groupedByTime[item.ts]) {
      groupedByTime[item.ts] = {
        ts: item.ts,
        lat: item.lat,
        lng: item.lng,
        factors: {}
      };
    }
    
    // 根据code映射到因子索引
    const factorMap = {
      'KQ301': 'factor1', // PM2.5
      'KQ302': 'factor2', // PM10
      'KQ303': 'factor3', // SO2
      'KQ304': 'factor4', // CO
      'KQ305': 'factor5', // NO2
      'KQ306': 'factor6', // O3
      'KQ307': 'factor7'  // VOCs
    };
    
    if (factorMap[item.code]) {
      groupedByTime[item.ts].factors[factorMap[item.code]] = item.value;
    }
  });
  
  // 转换为数组格式
  const result = Object.values(groupedByTime).map(item => {
    return [
      item.ts,                    // 时间戳
      item.lng,                   // 经度
      item.lat,                   // 纬度
      item.factors.factor1 || 0,  // PM2.5
      item.factors.factor2 || 0,  // PM10
      item.factors.factor3 || 0,  // SO2
      item.factors.factor4 || 0,  // CO
      item.factors.factor5 || 0,  // NO2
      item.factors.factor6 || 0,  // O3
      item.factors.factor7 || 0   // VOCs
    ];
  });
  
  return result;
}

// 使用示例
const valFormatted = convertTToVal(t);
console.log(valFormatted);